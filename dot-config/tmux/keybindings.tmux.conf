# =====================================================================================
# TMUX Key Bindings (Remote Server Compatible)
# =====================================================================================
# Remote 서버에서 사용하기 위한 순수 키 바인딩 설정
# 복잡한 환경 변수나 플러그인 의존성 없이 키 바인딩만 포함
#
# Usage:
#   source-file ~/.config/tmux/keybindings.tmux.conf
# =====================================================================================

# -------------------------------------------------------------------------------------- PREFIX
set -g prefix C-g
bind C-g send-prefix

# -------------------------------------------------------------------------------------- GENERAL
bind C-d detach
bind d detach
bind \; command-prompt
bind R source-file ~/.config/tmux/tmux.conf \; display-message "config reloaded"
bind Space switch-client -T root

# Toggle zoom pane
bind -n C-q if-shell -F '#{==:#{window_zoomed_flag},1}' 'resize-pane -Z' 'resize-pane -Z'

# Toggle status bar
bind C-h if -F '#{==:#{status},on}' 'set -g status off' 'set -g status on'

# Toggle pane border status
bind C-s if -F '#{==:#{pane-border-status},top}' 'set -g pane-border-status off' 'set -g pane-border-status top'

# Persistent popup shell
bind-key Enter if-shell -F '#{==:#{session_name},TMP_FLOAT}' \
  { detach-client } \
  { popup -E -w100% -h100% 'tmux attach -t TMP_FLOAT || tmux new -s TMP_FLOAT' }

# Pane history with less
bind C-l capture-pane -S - -E - -e -b lesshist \; new-window -n "lesshist" 'tmux show-buffer -b lesshist | less -R +G'

# -------------------------------------------------------------------------------------- SESSION: prefix + s
bind s switch-client -T session-mode
bind -n C-up switch-client -p
bind -n C-down switch-client -n
bind -T session-mode Escape switch-client -T root

# Session CRUD
bind -T session-mode n command-prompt -p "New session:" "new-session -s '%%'"
bind -T session-mode s choose-tree -sZ
bind -T session-mode r command-prompt -p "Rename session:" "rename-session '%%'"
bind -T session-mode Q confirm-before "kill-session"
bind -T session-mode q display-message 'Capital Q for quit session'

# Session Navigation
bind -T session-mode h switch-client -p \; switch-client -T session-mode
bind -T session-mode l switch-client -n \; switch-client -T session-mode
bind -T session-mode p switch-client -l \; switch-client -T session-mode

# -------------------------------------------------------------------------------------- WINDOW: prefix + w
bind w switch-client -T window-mode
bind -n C-] if-shell '[ "$(tmux list-windows | wc -l)" -gt 1 ]' 'next-window'
bind -n C-[ if-shell '[ "$(tmux list-windows | wc -l)" -gt 1 ]' 'previous-window'
bind -T window-mode Escape switch-client -T root

# Window CRUD
bind -T window-mode n command-prompt -p "New window:" "new-window -n '%%'"
bind -T window-mode w choose-tree -wZ
bind -T window-mode r command-prompt -I "" "rename-window '%%'"
bind -T window-mode q confirm-before "kill-window"

# Window Navigation
bind -T window-mode h previous-window \; switch-client -T window-mode
bind -T window-mode l next-window \; switch-client -T window-mode
bind -T window-mode p last-window \; switch-client -T window-mode
bind -T window-mode H swap-window -t -1 \; previous-window \; switch-client -T window-mode
bind -T window-mode L swap-window -t +1 \; next-window \; switch-client -T window-mode

# -------------------------------------------------------------------------------------- PANE
# Pane CRUD (from root)
bind v split-window -h \; switch-client -T pane-mode
bind x split-window -v \; switch-client -T pane-mode
bind V split-window -h -c "#{pane_current_path}" \; switch-client -T pane-mode
bind X split-window -v -c "#{pane_current_path}" \; switch-client -T pane-mode
bind q kill-pane \; switch-client -T pane-mode

# Mark pane
bind . select-pane -m

# Pane Navigation (global)
bind -n C-M-h select-pane -L
bind -n C-M-j select-pane -D
bind -n C-M-k select-pane -U
bind -n C-M-l select-pane -R

bind h select-pane -L \; switch-client -T pane-mode
bind j select-pane -D \; switch-client -T pane-mode
bind k select-pane -U \; switch-client -T pane-mode
bind l select-pane -R \; switch-client -T pane-mode
bind H swap-pane -U \; switch-client -T pane-mode
bind L swap-pane -D \; switch-client -T pane-mode

# -------------------------------------------------------------------------------------- PANE MODE: prefix + p
bind p switch-client -T pane-mode
bind -T pane-mode Escape switch-client -T root

# Pane mode - display
bind -T pane-mode p display-pane

# Pane mode - break/move
bind -T pane-mode b break-pane \; command-prompt -I "" "rename-window '%%'"
bind -T pane-mode m command-prompt -p "move pane to:" "move-pane -t '%%'"

# Pane mode - CRUD
bind -T pane-mode v split-window -h \; switch-client -T pane-mode
bind -T pane-mode x split-window -v \; switch-client -T pane-mode
bind -T pane-mode V split-window -h -c "#{pane_current_path}" \; switch-client -T pane-mode
bind -T pane-mode X split-window -v -c "#{pane_current_path}" \; switch-client -T pane-mode
bind -T pane-mode q kill-pane \; switch-client -T pane-mode

# Pane mode - Navigation
bind -T pane-mode h select-pane -L \; switch-client -T pane-mode
bind -T pane-mode j select-pane -D \; switch-client -T pane-mode
bind -T pane-mode k select-pane -U \; switch-client -T pane-mode
bind -T pane-mode l select-pane -R \; switch-client -T pane-mode
bind -T pane-mode H swap-pane -U \; switch-client -T pane-mode
bind -T pane-mode L swap-pane -D \; switch-client -T pane-mode

# -------------------------------------------------------------------------------------- RESIZE MODE: prefix + 4
bind 4 switch-client -T pane-resize-mode
bind -T pane-resize-mode Escape switch-client -T root
bind -T pane-resize-mode h resize-pane -L 4 \; switch-client -T pane-resize-mode
bind -T pane-resize-mode j resize-pane -D 4 \; switch-client -T pane-resize-mode
bind -T pane-resize-mode k resize-pane -U 4 \; switch-client -T pane-resize-mode
bind -T pane-resize-mode l resize-pane -R 4 \; switch-client -T pane-resize-mode
bind -T pane-resize-mode H resize-pane -L 10 \; switch-client -T pane-resize-mode
bind -T pane-resize-mode J resize-pane -D 10 \; switch-client -T pane-resize-mode
bind -T pane-resize-mode K resize-pane -U 10 \; switch-client -T pane-resize-mode
bind -T pane-resize-mode L resize-pane -R 10 \; switch-client -T pane-resize-mode
bind -T pane-resize-mode C-g switch-client -T pane-mode

# -------------------------------------------------------------------------------------- COPY MODE: prefix + i
bind i copy-mode
bind -T copy-mode     Escape                 send-keys -X clear-selection
bind -T copy-mode     \$                     send-keys -X end-of-line
bind -T copy-mode     \%                     send-keys -X next-matching-bracket
bind -T copy-mode     \'                     send-keys -FX search-forward "#{copy_cursor_word}"
bind -T copy-mode     Q                      send-keys -X jump-reverse
bind -T copy-mode     /                      command-prompt -T search -p "(search down)" { send-keys -X search-forward "%%" }
bind -T copy-mode     0                      send-keys -X start-of-line
bind -T copy-mode     1                      command-prompt -N -I 1 -p (repeat) { send-keys -N "%%" }
bind -T copy-mode     2                      command-prompt -N -I 2 -p (repeat) { send-keys -N "%%" }
bind -T copy-mode     3                      command-prompt -N -I 3 -p (repeat) { send-keys -N "%%" }
bind -T copy-mode     4                      command-prompt -N -I 4 -p (repeat) { send-keys -N "%%" }
bind -T copy-mode     5                      command-prompt -N -I 5 -p (repeat) { send-keys -N "%%" }
bind -T copy-mode     6                      command-prompt -N -I 6 -p (repeat) { send-keys -N "%%" }
bind -T copy-mode     7                      command-prompt -N -I 7 -p (repeat) { send-keys -N "%%" }
bind -T copy-mode     8                      command-prompt -N -I 8 -p (repeat) { send-keys -N "%%" }
bind -T copy-mode     9                      command-prompt -N -I 9 -p (repeat) { send-keys -N "%%" }
bind -T copy-mode     \;                     command-prompt -p "(goto line)" { send-keys -X goto-line "%%" }
bind -T copy-mode     :                      send-keys -X jump-again
bind -T copy-mode     ?                      command-prompt -T search -p "(search up)" { send-keys -X search-backward "%%" }
bind -T copy-mode     B                      send-keys -X previous-space
bind -T copy-mode     E                      send-keys -X next-space-end
bind -T copy-mode     F                      command-prompt -1 -p "(jump backward)" { send-keys -X jump-backward "%%" }
bind -T copy-mode     G                      send-keys -X history-bottom
bind -T copy-mode     H                      send-keys -X top-line
bind -T copy-mode     L                      send-keys -X bottom-line
bind -T copy-mode     M                      send-keys -X middle-line
bind -T copy-mode     N                      send-keys -X search-reverse
bind -T copy-mode     T                      command-prompt -1 -p "(jump to backward)" { send-keys -X jump-to-backward "%%" }
bind -T copy-mode     V                      send-keys -X select-line
bind -T copy-mode     W                      send-keys -X next-space
bind -T copy-mode     X                      send-keys -X set-mark
bind -T copy-mode     Y                      send-keys -X copy-line-and-cancel
bind -T copy-mode     ^                      send-keys -X back-to-indentation
bind -T copy-mode     b                      send-keys -X previous-word
bind -T copy-mode     e                      send-keys -X next-word-end
bind -T copy-mode     f                      command-prompt -1 -p "(jump forward)" { send-keys -X jump-forward "%%" }
bind -T copy-mode     g                      send-keys -X history-top
bind -T copy-mode     h                      send-keys -X cursor-left
bind -T copy-mode     i                      send-keys -X cancel
bind -T copy-mode     Space                  send-keys -X cancel
bind -T copy-mode     j                      send-keys -X cursor-down
bind -T copy-mode     k                      send-keys -X cursor-up
bind -T copy-mode     l                      send-keys -X cursor-right
bind -T copy-mode     n                      send-keys -X search-again
bind -T copy-mode     o                      send-keys -X other-end
bind -T copy-mode     r                      send-keys -X refresh-from-pane
bind -T copy-mode     t                      command-prompt -1 -p "(jump to forward)" { send-keys -X jump-to-forward "%%" }
bind -T copy-mode     v                      send-keys -X begin-selection
bind -T copy-mode     w                      send-keys -X next-word
bind -T copy-mode     y                      send-keys -X copy-selection-and-cancel
bind -T copy-mode     z                      send-keys -X scroll-middle
bind -T copy-mode     \{                     send-keys -X previous-paragraph
bind -T copy-mode     \}                     send-keys -X next-paragraph
bind -T copy-mode     C-v                    send-keys -X rectangle-toggle
bind -T copy-mode     C-q                    send-keys -X cancel \; resize-pane -Z
bind -T copy-mode     C-u                    send-keys -X halfpage-up
bind -T copy-mode     C-d                    send-keys -X halfpage-down

# -------------------------------------------------------------------------------------- MODE SWAP
bind 1 switch-client -T session-mode
bind 2 switch-client -T window-mode
bind 3 switch-client -T pane-mode

bind -T session-mode 1 switch-client -T session-mode
bind -T session-mode 2 switch-client -T window-mode
bind -T session-mode 3 switch-client -T pane-mode
bind -T session-mode 4 switch-client -T pane-resize-mode
bind -T session-mode i copy-mode
bind -T session-mode Space switch-client -T root

bind -T window-mode 1 switch-client -T session-mode
bind -T window-mode 2 switch-client -T window-mode
bind -T window-mode 3 switch-client -T pane-mode
bind -T window-mode 4 switch-client -T pane-resize-mode
bind -T window-mode i copy-mode
bind -T window-mode Space switch-client -T root

bind -T pane-mode 1 switch-client -T session-mode
bind -T pane-mode 2 switch-client -T window-mode
bind -T pane-mode 3 switch-client -T pane-mode
bind -T pane-mode 4 switch-client -T pane-resize-mode
bind -T pane-mode i copy-mode
bind -T pane-mode Space switch-client -T root

bind -T pane-resize-mode 1 switch-client -T session-mode
bind -T pane-resize-mode 2 switch-client -T window-mode
bind -T pane-resize-mode 3 switch-client -T pane-mode
bind -T pane-resize-mode 4 switch-client -T pane-resize-mode
bind -T pane-resize-mode i copy-mode
bind -T pane-resize-mode Space switch-client -T root
